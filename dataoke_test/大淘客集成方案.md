# å¤§æ·˜å®¢é›†æˆæ–¹æ¡ˆè®¾è®¡

## ğŸ¯ æ–¹æ¡ˆæ¦‚è¿°

åˆ›å»ºç‹¬ç«‹çš„å¤§æ·˜å®¢æœåŠ¡ç«¯ï¼Œä¸ºç°æœ‰å°ç¨‹åºç³»ç»Ÿæä¾›å¤§æ·˜å®¢å•†å“æ•°æ®æ¥å£ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å°ç¨‹åºç«¯       â”‚    â”‚  ç°æœ‰æœåŠ¡å™¨ç«¯    â”‚    â”‚  å¤§æ·˜å®¢æœåŠ¡ç«¯    â”‚
â”‚ (uni-app)       â”‚    â”‚ (ThinkPHP)      â”‚    â”‚ (ç‹¬ç«‹PHPæœåŠ¡)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å•†å“åˆ—è¡¨é¡µé¢   â”‚â—„â”€â”€â–ºâ”‚ â€¢ ç”¨æˆ·ç®¡ç†       â”‚â—„â”€â”€â–ºâ”‚ â€¢ å¤§æ·˜å®¢APIå°è£…  â”‚
â”‚ â€¢ å•†å“è¯¦æƒ…é¡µé¢   â”‚    â”‚ â€¢ è®¢å•ç®¡ç†       â”‚    â”‚ â€¢ å•†å“æ•°æ®ç¼“å­˜   â”‚
â”‚ â€¢ æœç´¢åŠŸèƒ½      â”‚    â”‚ â€¢ æ”¯ä»˜ç³»ç»Ÿ       â”‚    â”‚ â€¢ æ¨å¹¿é“¾æ¥ç”Ÿæˆ   â”‚
â”‚ â€¢ åˆ†ç±»æµè§ˆ      â”‚    â”‚ â€¢ æœ¬åœ°å•†å“ç®¡ç†   â”‚    â”‚ â€¢ æ•°æ®æ ¼å¼è½¬æ¢   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–²                        â–²
                                â”‚                        â”‚
                                â–¼                        â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   MySQLæ•°æ®åº“    â”‚    â”‚   å¤§æ·˜å®¢å®˜æ–¹API  â”‚
                       â”‚ â€¢ ç”¨æˆ·æ•°æ®       â”‚    â”‚ â€¢ å•†å“åˆ—è¡¨       â”‚
                       â”‚ â€¢ è®¢å•æ•°æ®       â”‚    â”‚ â€¢ å•†å“è¯¦æƒ…       â”‚
                       â”‚ â€¢ æœ¬åœ°å•†å“       â”‚    â”‚ â€¢ åˆ†ç±»ä¿¡æ¯       â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ç›®å½•ç»“æ„è®¾è®¡

```
dataoke-service/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ goods.php           # å•†å“ç›¸å…³æ¥å£
â”‚   â”œâ”€â”€ category.php        # åˆ†ç±»ç›¸å…³æ¥å£
â”‚   â”œâ”€â”€ search.php          # æœç´¢æ¥å£
â”‚   â””â”€â”€ common.php          # å…¬å…±å‡½æ•°
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ DataokeAdapter.php  # å¤§æ·˜å®¢é€‚é…å™¨
â”‚   â””â”€â”€ openapi-sdk-php/    # å®˜æ–¹SDK
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.php          # é…ç½®æ–‡ä»¶
â”œâ”€â”€ cache/
â”‚   â””â”€â”€ goods_cache/        # å•†å“ç¼“å­˜
â””â”€â”€ index.php               # å…¥å£æ–‡ä»¶
```

## ğŸ”Œ APIæ¥å£è®¾è®¡

### 1. å•†å“åˆ—è¡¨æ¥å£
```
GET /api/goods.php?action=list
å‚æ•°ï¼š
- page: é¡µç  (é»˜è®¤1)
- pageSize: æ¯é¡µæ•°é‡ (é»˜è®¤20)
- categoryId: åˆ†ç±»ID (å¯é€‰)
- keyword: æœç´¢å…³é”®è¯ (å¯é€‰)
- sort: æ’åºæ–¹å¼ (å¯é€‰)
- minCoupon: æœ€ä½ä¼˜æƒ åˆ¸é¢é¢ (å¯é€‰)

è¿”å›æ ¼å¼ï¼š
{
  "code": 0,
  "message": "success",
  "data": {
    "list": [
      {
        "id": "å•†å“ID",
        "title": "å•†å“æ ‡é¢˜",
        "pic": "å•†å“å›¾ç‰‡",
        "price": "åˆ¸åä»·",
        "original_price": "åŸä»·",
        "coupon_price": "ä¼˜æƒ åˆ¸é¢é¢",
        "coupon_link": "ä¼˜æƒ åˆ¸é“¾æ¥",
        "sale_count": "é”€é‡",
        "shop_name": "åº—é“ºåç§°"
      }
    ],
    "total": æ€»æ•°é‡,
    "page": å½“å‰é¡µç ,
    "pageSize": æ¯é¡µæ•°é‡
  }
}
```

### 2. å•†å“è¯¦æƒ…æ¥å£
```
GET /api/goods.php?action=detail&id=å•†å“ID

è¿”å›æ ¼å¼ï¼š
{
  "code": 0,
  "message": "success",
  "data": {
    "id": "å•†å“ID",
    "title": "å•†å“æ ‡é¢˜",
    "pics": ["å›¾ç‰‡1", "å›¾ç‰‡2"],
    "price": "åˆ¸åä»·",
    "original_price": "åŸä»·",
    "coupon_price": "ä¼˜æƒ åˆ¸é¢é¢",
    "coupon_conditions": "ä½¿ç”¨æ¡ä»¶",
    "coupon_link": "ä¼˜æƒ åˆ¸é“¾æ¥",
    "desc": "å•†å“æè¿°",
    "shop_name": "åº—é“ºåç§°",
    "sale_count": "é”€é‡"
  }
}
```

### 3. åˆ†ç±»åˆ—è¡¨æ¥å£
```
GET /api/category.php?action=list

è¿”å›æ ¼å¼ï¼š
{
  "code": 0,
  "message": "success",
  "data": [
    {
      "id": "åˆ†ç±»ID",
      "name": "åˆ†ç±»åç§°",
      "pic": "åˆ†ç±»å›¾ç‰‡"
    }
  ]
}
```

### 4. æœç´¢æ¥å£
```
GET /api/search.php?keyword=å…³é”®è¯&page=1&pageSize=20

è¿”å›æ ¼å¼ï¼šåŒå•†å“åˆ—è¡¨æ¥å£
```

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### 1. æ•°æ®ç¼“å­˜ç­–ç•¥
```php
// å•†å“åˆ—è¡¨ç¼“å­˜30åˆ†é’Ÿ
$cacheKey = "goods_list_" . md5(serialize($params));
$cacheTime = 1800; // 30åˆ†é’Ÿ

// å•†å“è¯¦æƒ…ç¼“å­˜1å°æ—¶
$cacheKey = "goods_detail_" . $goodsId;
$cacheTime = 3600; // 1å°æ—¶

// åˆ†ç±»ä¿¡æ¯ç¼“å­˜24å°æ—¶
$cacheKey = "category_list";
$cacheTime = 86400; // 24å°æ—¶
```

### 2. æ•°æ®æ ¼å¼è½¬æ¢
```php
// å°†å¤§æ·˜å®¢æ•°æ®æ ¼å¼è½¬æ¢ä¸ºå°ç¨‹åºéœ€è¦çš„æ ¼å¼
function convertGoodsData($dataokeGoods) {
    return [
        'id' => $dataokeGoods['goodsId'],
        'name' => $dataokeGoods['title'],
        'pic' => $dataokeGoods['mainPic'],
        'price' => $dataokeGoods['actualPrice'],
        'original_price' => $dataokeGoods['originalPrice'],
        'coupon_price' => $dataokeGoods['couponPrice'],
        'sale_count' => $dataokeGoods['monthSales'],
        // ... æ›´å¤šå­—æ®µæ˜ å°„
    ];
}
```

### 3. é”™è¯¯å¤„ç†
```php
// ç»Ÿä¸€é”™è¯¯å¤„ç†
function apiResponse($code, $message, $data = null) {
    header('Content-Type: application/json');
    echo json_encode([
        'code' => $code,
        'message' => $message,
        'data' => $data
    ], JSON_UNESCAPED_UNICODE);
    exit;
}
```

## ğŸ“± å°ç¨‹åºç«¯é›†æˆ

### 1. ä¿®æ”¹è¯·æ±‚é…ç½®
```javascript
// åœ¨ common/request.js ä¸­æ·»åŠ å¤§æ·˜å®¢æ¥å£
const DATAOKE_BASE_URL = 'http://your-domain.com/dataoke-service/api/';

// å¤§æ·˜å®¢å•†å“åˆ—è¡¨
getDataokeGoods: function(params) {
    return new Promise((resolve, reject) => {
        uni.request({
            url: DATAOKE_BASE_URL + 'goods.php?action=list',
            data: params,
            method: 'GET',
            success: function(res) {
                resolve(res.data);
            }
        });
    });
}
```

### 2. é¡µé¢é›†æˆç¤ºä¾‹
```vue
<!-- åœ¨ goodsList.vue ä¸­æ·»åŠ å¤§æ·˜å®¢å•†å“ -->
<template>
  <view class="goods-container">
    <!-- åŸæœ‰å•†å“ -->
    <view class="local-goods">
      <view class="section-title">æœ¬åœ°å•†å“</view>
      <!-- ç°æœ‰å•†å“åˆ—è¡¨ -->
    </view>
    
    <!-- å¤§æ·˜å®¢å•†å“ -->
    <view class="dataoke-goods">
      <view class="section-title">ä¼˜æƒ å•†å“</view>
      <view class="goods-list">
        <view class="goods-item" v-for="item in dataokeGoods" :key="item.id">
          <image :src="item.pic" class="goods-image"></image>
          <view class="goods-info">
            <text class="goods-title">{{item.name}}</text>
            <view class="price-info">
              <text class="current-price">Â¥{{item.price}}</text>
              <text class="original-price">Â¥{{item.original_price}}</text>
              <text class="coupon">åˆ¸Â¥{{item.coupon_price}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
import request from '@/common/request.js'

export default {
  data() {
    return {
      dataokeGoods: []
    }
  },
  onLoad() {
    this.loadDataokeGoods();
  },
  methods: {
    async loadDataokeGoods() {
      try {
        const result = await request.getDataokeGoods({
          page: 1,
          pageSize: 20,
          minCoupon: 10
        });
        if (result.code === 0) {
          this.dataokeGoods = result.data.list;
        }
      } catch (error) {
        console.error('åŠ è½½å¤§æ·˜å®¢å•†å“å¤±è´¥:', error);
      }
    }
  }
}
</script>
```

## ğŸš€ éƒ¨ç½²å»ºè®®

### 1. æœåŠ¡å™¨è¦æ±‚
- PHP 7.4+
- MySQL 5.7+ (ç”¨äºç¼“å­˜)
- Nginx/Apache
- SSLè¯ä¹¦ (HTTPS)

### 2. é…ç½®æ–‡ä»¶
```php
// config/config.php
return [
    'dataoke' => [
        'app_key' => '678fc81d72259',
        'app_secret' => '6fd2acba8bce6c039ab276256f003ced',
        'pid' => 'mm_52162983_2267550029_112173400498',
        'version' => 'v1.2.4'
    ],
    'cache' => [
        'type' => 'file', // file, redis, mysql
        'path' => __DIR__ . '/../cache/',
        'expire' => 1800 // é»˜è®¤ç¼“å­˜æ—¶é—´
    ],
    'cors' => [
        'allow_origin' => '*',
        'allow_methods' => 'GET,POST,OPTIONS',
        'allow_headers' => 'Content-Type,Authorization'
    ]
];
```

## ğŸ“ˆ ä¼˜åŠ¿æ€»ç»“

1. **ç‹¬ç«‹æ€§å¼º** - ä¸å½±å“ç°æœ‰ç³»ç»Ÿç¨³å®šæ€§
2. **æ˜“äºç»´æŠ¤** - ä¸“é—¨å¤„ç†å¤§æ·˜å®¢ç›¸å…³åŠŸèƒ½
3. **æ€§èƒ½ä¼˜åŒ–** - ç‹¬ç«‹ç¼“å­˜ï¼Œå‡å°‘APIè°ƒç”¨
4. **æ‰©å±•æ€§å¥½** - å¯ä»¥è½»æ¾æ·»åŠ å…¶ä»–è”ç›Ÿå¹³å°
5. **å®‰å…¨å¯æ§** - APIå¯†é’¥é›†ä¸­ç®¡ç†
6. **æˆæœ¬ä½å»‰** - å¤ç”¨ç°æœ‰åŸºç¡€è®¾æ–½

## ğŸ”„ å®æ–½æ­¥éª¤

1. **ç¬¬ä¸€é˜¶æ®µ**: åˆ›å»ºç‹¬ç«‹å¤§æ·˜å®¢æœåŠ¡ç«¯
2. **ç¬¬äºŒé˜¶æ®µ**: å¼€å‘APIæ¥å£å’Œç¼“å­˜æœºåˆ¶
3. **ç¬¬ä¸‰é˜¶æ®µ**: å°ç¨‹åºç«¯é›†æˆæµ‹è¯•
4. **ç¬¬å››é˜¶æ®µ**: ä¸Šçº¿éƒ¨ç½²å’Œç›‘æ§

è¿™ä¸ªæ–¹æ¡ˆæ—¢ä¿æŒäº†ç³»ç»Ÿçš„ç‹¬ç«‹æ€§ï¼Œåˆèƒ½æœ‰æ•ˆé›†æˆå¤§æ·˜å®¢åŠŸèƒ½ï¼Œæ˜¯æœ€ä½³çš„æŠ€æœ¯é€‰æ‹©ã€‚
